(function(){Number.prototype.toPercent=function(){return(Math.round(this*10000)/100).toFixed(2)+"%"};var a=function(g){if(!(this instanceof a)){return new a(g)}var h=this;var b={};var e=[];var f={};var j;var k=[];var i=new Date().getTime();var d={id:"",level:3,levelDesc:["省份","城市","区县","乡镇","社区"],index:"996",separator:" / ",isInitClick:true,isWithMouse:false,offsetX:0,offsetY:0,emptyText:"暂无数据",theme:"blue",data:""};var c=d;h._init=function(){if(!h._validateConfig()){return}h._loadResource();var n='<div id="adp-wraper-'+i+'" class="adp-wraper" style="z-index: '+c.index+'"><p>';var l='<div style="display: block"><ul></ul></div>';n+='<span class="adp-head-active">'+c.levelDesc[0]+"</span><span>"+c.levelDesc[0]+"</span>";for(var m=1;m<c.level;m++){n+="<span>"+c.levelDesc[m]+"</span>";l+='<div><ul><span class="adp-empty-text">'+c.emptyText+"</span></ul></div>"}n+="</p>";$("body").append(n+l+'</div><div class="adp-wraper-backshadow" style="z-index: '+(c.index-1)+'"></div>');if(typeof c.data=="string"&&!h._isJSON(c.data)){$.ajax({url:c.data,async:false,success:function(o){j=o;h._getEachLevelData(0,c.level,j);h._initFirstLevelData()}})}else{j=c.data;if(typeof c.data=="string"){j=JSON.parse(j)}h._getEachLevelData(0,c.level,j);h._initFirstLevelData()}h._bindEvent()};h._getEachLevelData=function(m,r,o){var q=[];var p=[];if(m>=r){return}for(var n=0;n<o.length;n++){q.push(o[n]);if(m==r-1){continue}if(o[n].children==undefined){continue}for(var l=0;l<o[n].children.length;l++){p.push(o[n].children[l])}}if(p.length==0){return}b["data_level_"+m]=q;h._getEachLevelData(m+1,r,p)};h._validateConfig=function(){var l=true;if(g instanceof Object){c=$.extend({},d,g)}else{if(typeof(g)=="string"){c.id=g}else{l=false}}if(c.level>c.levelDesc.length){c.levelDesc=d.levelDesc}if(c.theme!="blue"&&c.theme!="green"){c.theme="blue"}if(c.id==""||c.id==undefined){l=false}else{if($("#"+c.id).length==0){l=false}}return l};h._initFirstLevelData=function(){for(var m=0;m<j.length;m++){var l='<li data-code="'+j[m].code+'" title="'+j[m].name+'">'+j[m].name+"</li>";$("div.adp-wraper").children("div").eq(0).children().append(l)}};h._bindEvent=function(){$("#adp-wraper-"+i+" div ul").delegate("li","click",function(){var n=$(this).parent().parent().index();f.code=$(this).data("code");f.text=$(this).text();f.level=n;var l=j;e[n-1]=$(this).data("code");k[n-1]=$(this).text();var u=$("#adp-wraper-"+i).children("div").length;if(n<u){$("#adp-wraper-"+i).children("div").eq(n).children().empty();if(n>1){l=b["data_level_"+(n-1)]}if(l!=undefined){for(var r=0;r<l.length;r++){var m=l[r];if(m.name==$(this).text()&&m.code==$(this).data("code")){for(var q=0;q<m.children.length;q++){var p=m.children[q];var t='<li data-code="'+p.code+'" title="'+p.name+'">'+p.name+"</li>";$("#adp-wraper-"+i).children("div").eq(n).children().append(t)}break}}}else{$("#adp-wraper-"+i).children("div").eq(n).children().append('<span class="adp-empty-text">'+c.emptyText+"</span>")}$(this).addClass("adp-active").siblings().removeClass("adp-active");var s=$("#adp-wraper-"+i).children("p").children("span").eq(n+1).text();var v=$("#adp-wraper-"+i).children("p").children("span.adp-head-active");v.css("left",(0.2*(n)).toPercent());setTimeout(function(){v.text(s)},200);$(this).parent().parent().next().show().siblings("div").hide()}else{$(this).addClass("adp-active").siblings().removeClass("adp-active");$("#adp-wraper-"+i).fadeOut();$("div.adp-wraper-backshadow").hide()}});$("#adp-wraper-"+i+" p span").click(function(){if($(this).hasClass("adp-head-active")){return}var l=$(this).index()-1;var n=$(this).text();var m=$("#adp-wraper-"+i).children("p").children("span.adp-head-active");m.css("left",(0.2*l).toPercent());setTimeout(function(){m.text(n)},200);$("#adp-wraper-"+i).children("div").eq(l).show().siblings("div").hide()});$("div.adp-wraper-backshadow").on("click",function(){$("div.adp-wraper-backshadow").hide();$("#adp-wraper-"+i).fadeOut()});if(c.isInitClick){$("#"+c.id).on("click",function(){var l=h._getOffset(event);$("#adp-wraper-"+i).css("left",l.x);$("#adp-wraper-"+i).css("top",l.y);$("#adp-wraper-"+i).fadeIn();$(".adp-wraper-backshadow").show()})}};h._loadResource=function(){var l="";var n=$("head script");if(n.length>0){for(var p=0;p<n.length;p++){if(n[p].src.indexOf("/js/address-picker.js")!=-1){l=n[p].src.substring(0,n[p].src.indexOf("/js/address-picker.js"));break}}}if(l!=""){var o=document.getElementsByTagName("head")[0];var m=document.createElement("script");var q=document.createElement("link");q.href=l+"/css/address-picker-"+c.theme+".css";q.rel="stylesheet";q.type="text/css";o.appendChild(q);if(c.level==1||c.level==2){c.data=l+"/data/pc-code.json"}else if(c.level==4||c.level==5){c.data=l+"/data/pcas-code.json"}else{c.data=l+"/data/pca-code.json"}}};h._getOffset=function(m){var l=$("#"+c.id).offset().left-10;var q=$("#"+c.id).offset().top+$("#"+c.id).height()+5;if(c.isWithMouse){var o=m||window.event;var p=document.documentElement.scrollLeft||document.body.scrollLeft;var n=document.documentElement.scrollTop||document.body.scrollTop;l=o.pageX||o.clientX+p;q=o.pageY||o.clientY+n}l+=c.offsetX;q+=c.offsetY;return{"x":l,"y":q}};h._isJSON=function(n){if(typeof n=="string"){try{var m=JSON.parse(n);if(typeof m=="object"&&m){return true}else{return false}}catch(l){return false}}};h._getTotalValueAsArray=function(){return{"code":e,"text":k}};h._getTotalValueAsText=function(){var m="";for(var l=0;l<f.level;l++){m+=(l<f.level-1?k[l]+c.separator:k[l])}return m};h._getCurrentObject=function(){return f};h._show=function(){var l=h._getOffset(event);$("#adp-wraper-"+i).css("left",l.x);$("#adp-wraper-"+i).css("top",l.y);$("#adp-wraper-"+i).fadeIn();$(".adp-wraper-backshadow").show()};h._hide=function(){$("#adp-wraper-"+i).fadeOut();$("div.adp-wraper-backshadow").hide()};h._on=function(l,m){$("#adp-wraper-"+i+" div ul").delegate("li",l,m)};h._init();return{on:h._on,show:h._show,hide:h._hide,getCurrentObject:h._getCurrentObject,getTotalValueAsArray:h._getTotalValueAsArray,getTotalValueAsText:h._getTotalValueAsText}};window.addressPicker=a}());
